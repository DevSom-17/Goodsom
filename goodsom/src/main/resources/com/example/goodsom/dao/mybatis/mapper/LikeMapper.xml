<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- AuctionMapper 인터페이스의 package이름과 같아야 함 -->
<mapper namespace="com.example.goodsom.dao.mybatis.mapper.AuctionMapper">
  
  <select id="getAuction" parameterType="java.lang.Integer" resultMap="resultMap_auction"> 
    SELECT auctionId, title, content, startPrice, uploadDate, endDate, count, maxPrice, state, 
    		receive, menuId, userId, sendNoti
    FROM AUCTIONS
    WHERE auctionId = #{auctionId}
  </select>
  
  <insert id="createAuction" parameterType="com.example.goodsom.domain.Auction">
  	
  	INSERT INTO AUCTIONS (TITLE, CONTENT, STARTPRICE, UPLOADDATE, ENDDATE, COUNT, 
  							MAXPRICE, STATE, RECEIVE, MENUID, USERID, SENDNOTI)
	VALUES (#{title}, #{content}, #{startPrice}, #{uploadDate}, #{endDate}, #{count}, 
			#{maxPrice}, #{state}, #{receive}, #{menuId}, #{userId}, #{sendNoti})
  	<selectKey keyProperty="auctionId" resultType="int" order="AFTER">
  		SELECT LAST_INSERT_ID()
     </selectKey>
  </insert>
  

   
  <delete id="deleteAuction" parameterType="java.lang.Integer">
    DELETE FROM AUCTIONS
    WHERE  AUCTIONID=#{auctionId}
  </delete>

  
  <!-- 경매가 마감된 이후에 알림을 보내기 위한 쿼리 -->
  <select id="getAuctionIdForNoti" resultType="Integer">
	  	SELECT auctionId
    	FROM AUCTIONS
	    WHERE STATE = 'closed' AND sendNoti=0
  </select>
  

</mapper>